services:
 swagger-ui:
  image: swaggerapi/swagger-ui
  container_name: swagger-ui
  ports:
    - "8080:8080"
  environment:
    - SWAGGER_JSON=/usr/share/nginx/html/docs/swagger.yml
    - BASE_URL=/swagger
  volumes:
    - ./swagger:/usr/share/nginx/html/docs
  depends_on:
    - backend

 backend:
   build: ./backend
   container_name: backend
   ports:
     - "7000:7000"
   env_file:
     - .env
   # This is a volume mapping - maps the local "backend" directory to "/app" in the container
   # This means:
   #   - Code changes made locally are immediately reflected inside the container.
   #   - Files created in the container (like Django migrations) are saved locally.
   volumes:
     - ./backend:/app
   working_dir: /app

 frontend:
   build: ./frontend
   container_name: frontend
   depends_on:
     - backend
   ports:
     - "19000:19000" # Expo go port
     - "19001:19001" # WebSocket debugger port
     - "8081:8081" # Metro bundler port
   volumes:
     - ./frontend:/app
   working_dir: /app
   tty: true
   stdin_open: true
   extra_hosts:
      - "host.docker.internal:host-gateway"

# IPv6 is REQUIRED for Supabase DB connection (their DB host is IPv6-only)
# Please check that:
# 1.) Docker is running with IPv6 enabled in network settings
# 2.) Windows Network Adapter → Properties → "Internet Protocol Version 6 (TCP/IPv6)" is checked
networks:
  default:
    enable_ipv6: true
