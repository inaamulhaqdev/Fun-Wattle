services:
 swagger-ui:
  image: swaggerapi/swagger-ui
  container_name: swagger-ui
  ports:
    - "8080:8080"
  environment:
    # Point Swagger UI at the mounted file. Use an absolute host path so Docker can
    # resolve the bind-mount correctly under WSL/Docker Desktop.
    - SWAGGER_JSON=/usr/share/nginx/html/swagger.yml
    - BASE_URL=/swagger
  volumes:
    # Use ${PWD} to ensure Docker sees the correct absolute path for the bind mount.
    - ${PWD}/swagger.yml:/usr/share/nginx/html/swagger.yml:ro
  depends_on:
    - backend

 backend:
   build: ./backend
   container_name: backend
   ports:
     - "7000:7000"
   env_file:
     - .env
   # This is a volume mapping - maps the local "backend" directory to "/app" in the container
   # This means:
   #   - Code changes made locally are immediately reflected inside the container.
   #   - Files created in the container (like Django migrations) are saved locally.
   volumes:
     - ./backend:/app
   working_dir: /app

 frontend:
  build: ./frontend
  container_name: frontend
  ports:
    - "8000:8000"
    - "8888:8888"
    - "19000:19000"
    - "19001:19001"
    - "19002:19002"
  depends_on:
    - backend
  env_file:
    - .env
  environment:
    - EXPO_DEVTOOLS_LISTEN_ADDRESS=0.0.0.0
    - REACT_NATIVE_PACKAGER_HOSTNAME=${HOST_IP}
  # Optional: mount frontend for live edits during development
  volumes:
    - ./frontend:/app


# IPv6 is REQUIRED for Supabase DB connection (their DB host is IPv6-only)
# Please check that:
# 1.) Docker is running with IPv6 enabled in network settings
# 2.) Windows Network Adapter → Properties → "Internet Protocol Version 6 (TCP/IPv6)" is checked
networks:
  default:
    enable_ipv6: true
