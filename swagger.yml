openapi: 3.0.0
info:
  title: Funwattle MVP API
  description: API for the Funwattle MVP app - a speech therapy assistance app
  version: 1.0.0
servers:
  - url: http://localhost:7000/api
    description: Backend Server

paths:
  /create:
    post:
      summary: Register a new user
      description: Register a new user (Parent or Therapist)
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                email:
                  type: string
                user_type:
                  type: string
                  enum: [parent, therapist]
              required:
                - id
                - email
                - user_type
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Missing required fields or invalid user type

  /subscribe:
    post:
      summary: Update user subscription
      description: Update a user's subscription status and type
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                subscription_type:
                  type: string
                subscription_end:
                  type: string
                  format: date-time
              required:
                - id
                - subscription_type
      responses:
        '200':
          description: Subscription updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Missing required fields
        '404':
          description: User not found
  /profile:
    post:
      summary: Create a new profile
      description: Create a new profile for a user
      tags:
        - Profiles
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: string
                name:
                  type: string
                creating_child_profile:
                  type: boolean
                profile_picture:
                  type: string
                  format: uri
                pin_hash:
                  type: string
                child_details:
                  type: object
              required:
                - user_id
                - name
                - creating_child_profile
      responses:
        '201':
          description: Profile created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  profile:
                    $ref: '#/components/schemas/Profile'
                  user_profile:
                    $ref: '#/components/schemas/UserProfile'
        '400':
          description: Missing required fields
        '404':
          description: User not found

  /profile/{profile_id}:
    get:
      summary: Get profile by ID
      description: Retrieve a specific profile by its ID
      tags:
        - Profiles
      parameters:
        - name: profile_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Profile found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'
        '404':
          description: Profile not found

  /profiles/{user_id}:
    get:
      summary: Get all profiles for a user
      description: Retrieve all profiles associated with a user
      tags:
        - Profiles
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of profiles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Profile'
        '404':
          description: User not found

  /learning_units:
    get:
      summary: Get all learning units
      description: Retrieve all available learning units
      tags:
        - Learning Unit
      parameters:
        - name: child_id
          in: query
          required: false
          schema:
            type: string
      responses:
        '200':
          description: List of learning units
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LearningUnit'

  /exercises/{learning_unit_id}:
    get:
      summary: Get exercises for a learning unit
      description: Retrieve all exercises for a specific learning unit
      tags:
        - Learning Unit
      parameters:
        - name: learning_unit_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of exercises
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Exercise'
        '404':
          description: Learning unit not found

  /questions/{exercise_id}:
    get:
      summary: Get questions for an exercise
      description: Retrieve all questions for a specific exercise
      tags:
        - Learning Unit
      parameters:
        - name: exercise_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of questions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Question'
        '404':
          description: Exercise not found
  /activities/{user_id}:
    get:
      summary: Get assigned activities
      description: Retrieve all activities assigned by a user
      tags:
        - Learning Unit
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of assigned activities
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Assignment'
        '404':
          description: User not found

  /assignments/{child_id}:
    get:
      summary: Get assignments for a child
      description: Retrieve all assignments for a specific child
      tags:
        - Learning Unit
      parameters:
        - name: child_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of assignments
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Assignment'
        '404':
          description: Child profile not found
    
    post:
      summary: Create or update assignment
      description: Create or update an assignment for a child
      tags:
        - Learning Unit
      parameters:
        - name: child_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                learning_unit_id:
                  type: string
                user_id:
                  type: string
                participation_type:
                  type: string
                  enum: [required, recommended]
              required:
                - learning_unit_id
                - user_id
                - participation_type
      responses:
        '201':
          description: Assignment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Assignment'
        '400':
          description: Missing required fields or invalid participation type
        '404':
          description: Child profile, learning unit, or user not found

  /assignments/{child_id}/learning_unit/{learning_unit_id}:
    delete:
      summary: Remove assignment
      description: Remove a learning unit assignment from a child
      tags:
        - Learning Unit
      parameters:
        - name: child_id
          in: path
          required: true
          schema:
            type: string
        - name: learning_unit_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Assignment removed successfully
        '404':
          description: Assignment, child profile, or learning unit not found

  /results/{child_id}:
    get:
      summary: Get exercise results
      description: Retrieve all exercise results for a child
      tags:
        - Learning Unit
      parameters:
        - name: child_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of exercise results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ExerciseResult'
        '404':
          description: Child profile not found

  /results/{child_id}/exercise/{exercise_id}:
    get:
      summary: Get results for specific exercise
      description: Retrieve results for a specific exercise for a child
      tags:
        - Learning Unit
      parameters:
        - name: child_id
          in: path
          required: true
          schema:
            type: string
        - name: exercise_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of exercise results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ExerciseResult'
        '404':
          description: Child profile or exercise not found
    
    post:
      summary: Create or update exercise result
      description: Create or update a result for a specific exercise for a child
      tags:
        - Learning Unit
      parameters:
        - name: child_id
          in: path
          required: true
          schema:
            type: string
        - name: exercise_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                time_spent:
                  type: integer
                accuracy:
                  type: number
                  format: float
              required:
                - time_spent
                - accuracy
      responses:
        '201':
          description: Result created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExerciseResult'
        '404':
          description: Child profile, exercise, or assignment not found

components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        user_type:
          type: string
          enum: [parent, therapist]
        email:
          type: string
        subscription_type:
          type: string
          nullable: true
          description: Type of subscription. Can be null for users without an active subscription.
        subscription_end:
          type: string
          format: date-time
          nullable: true
          description: End date of the subscription. Can be null for users without an active subscription.

    Profile:
      type: object
      properties:
        id:
          type: string
        profile_type:
          type: string
          enum: [parent, therapist, child]
        name:
          type: string
        profile_picture:
          type: string
          format: uri
        pin_hash:
          type: string
        child_details:
          type: object
        created_at:
          type: string
          format: date-time

    UserProfile:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        profile:
          $ref: '#/components/schemas/Profile'

    LearningUnit:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
        is_assigned:
          type: boolean
        image:
          type: string

    Exercise:
      type: object
      properties:
        id:
          type: string
        learning_unit:
          $ref: '#/components/schemas/LearningUnit'
        title:
          type: string
        description:
          type: string
        order: 
          type: integer
        exercise_type:
          type: string
          enum: [multiple_drag, multiple_select, ordered_drag, speaking]

    Question:
      type: object
      properties:
        id:
          type: string
        exercise:
          $ref: '#/components/schemas/Exercise'
        order: 
          type: integer
        exercise_type:
          type: string
          enum: [multiple_drag, multiple_select, ordered_drag, speaking]
        question_data:
          type: string
          format: JSON
          description: This will be JSON data

    Assignment:
      type: object
      properties:
        id:
          type: string
        learning_unit:
          $ref: '#/components/schemas/LearningUnit'
        assigned_to:
          $ref: '#/components/schemas/Profile'
        assigned_by:
          $ref: '#/components/schemas/User'
        participation_type:
          type: string
          enum: [required, recommended]
        assigned_at:
          type: string
          format: date-time
        due_date:
          type: string
          format: date-time
          nullable: true
        completed_at:
          type: string
          format: date-time
          nullable: true

    ExerciseResult:
      type: object
      properties:
        id:
          type: string
        assignment:
          $ref: '#/components/schemas/Assignment'
        exercise:
          $ref: '#/components/schemas/Exercise'
        time_spent:
          type: integer
        accuracy:
          type: number
          format: float
        completed_at:
          type: string
          format: date-time