openapi: 3.0.0
info:
  title: Funwattle MVP API
  description: API for the Funwattle MVP app - a speech therapy assistance app
  version: 1.0.0
servers:
  - url: https://funwattle-web-service.onrender.com/api
    description: Backend Server

paths:
  /user/create/:
    post:
      summary: Register a new user
      description: Register a new user (Parent or Therapist)
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                email:
                  type: string
                user_type:
                  type: string
                  enum: [parent, therapist]
              required:
                - id
                - email
                - user_type
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Missing required fields or invalid user type

  /user/subscribe/:
    post:
      summary: Update user subscription
      description: Update a user's subscription status and type
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                subscription_type:
                  type: string
                subscription_end:
                  type: string
                  format: date-time
              required:
                - id
                - subscription_type
      responses:
        '200':
          description: Subscription updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Missing required fields
        '404':
          description: User not found

  /profile/create/:
    post:
      summary: Create a new profile
      description: Create a new profile for a user
      tags:
        - Profiles
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: string
                name:
                  type: string
                creating_child_profile:
                  type: boolean
                profile_picture:
                  type: string
                  format: uri
                pin_hash:
                  type: string
                child_details:
                  type: object
              required:
                - user_id
                - name
                - creating_child_profile
      responses:
        '201':
          description: Profile created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  profile:
                    $ref: '#/components/schemas/Profile'
                  user_profile:
                    $ref: '#/components/schemas/User_Profile'
        '400':
          description: Missing required fields
        '404':
          description: User not found

  /profile/{user_id}/list/:
    get:
      summary: Get all profiles for a user
      description: Retrieve all profiles associated with a user
      tags:
        - Profiles
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of profiles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Profile'
        '404':
          description: User not found

  /profile/{profile_id}/data/:
    get:
      summary: Get profile information for a specific profile
      description: Retrieve profile information by profile ID
      tags:
        - Profiles
      parameters:
        - name: profile_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Profile found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'
        '404':
          description: Profile not found

  /content/learning_units/:
    get:
      summary: Get all learning units
      description: Retrieve all available learning units
      tags:
        - Content Library
      responses:
        '200':
          description: List of learning units
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Learning_Unit'

  /content/{learning_unit_id}/exercises/:
    get:
      summary: Get exercises for a learning unit
      description: Retrieve all exercises for a specific learning unit
      tags:
        - Content Library
      parameters:
        - name: learning_unit_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of exercises
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Exercise'
        '404':
          description: Learning unit not found

  /content/{exercise_id}/questions/:
    get:
      summary: Get questions for an exercise
      description: Retrieve all questions for a specific exercise
      tags:
        - Content Library
      parameters:
        - name: exercise_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of questions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Question'
        '404':
          description: Exercise not found

  /assignment/create/:
    post:
      summary: Assign a learning unit to a child
      description: Create a new assignment of a learning unit to a child
      tags:
        - Assignments
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                child_id:
                  type: string
                learning_unit_id:
                  type: string
                user_id:
                  type: string
                participation_type:
                  type: string
                  enum: [required, recommended]
                num_question_attempts:
                  type: integer
              required:
                - child_id
                - learning_unit_id
                - user_id
                - participation_type
      responses:
        '201':
          description: Assignment created successfully
        '400':
          description: Missing required fields or assignment already exists
        '404':
          description: Child profile, user, or learning unit not found
        '500':
          description: Failed to create assignment

  /assignment/complete/:
    post:
      summary: Mark a learning unit assignment as completed for a child
      description: Mark a specific learning unit assignment as completed for a child
      tags:
        - Assignments
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                child_id:
                  type: string
                learning_unit_id:
                  type: string
              required:
                - child_id
                - learning_unit_id
      responses:
        '200':
          description: Assignment completed successfully
        '400':
          description: Missing required fields
        '404':
          description: Assignment, child profile, or learning unit not found

  /assignment/{user_id}/assigned_by/:
    get:
      summary: Get all learning units a user has assigned
      description: Retrieve all learning units assigned by a user
      tags:
        - Assignments
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of assigned learning units
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Assignment'
        '404':
          description: User not found

  /assignment/{child_id}/assigned_to/:
    get:
      summary: Get all learning units a child has been assigned
      description: Retrieve all assignments for a specific child
      tags:
        - Assignments
      parameters:
        - name: child_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of assignments
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Assignment'
        '404':
          description: Child profile not found

  /assignment/{child_id}/unassign/{learning_unit_id}/:
    delete:
      summary: Unassign a learning unit from a child
      description: Unassign a learning unit from a child
      tags:
        - Assignments
      parameters:
        - name: child_id
          in: path
          required: true
          schema:
            type: string
        - name: learning_unit_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Assignment removed successfully
        '404':
          description: Assignment, child profile, or learning unit not found

  /result/{child_id}/all/:
    get:
      summary: Get all exercise results for a child
      description: Retrieve all exercise results for a child
      tags:
        - Child Results
      parameters:
        - name: child_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of exercise results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Exercise_Result'
        '404':
          description: Child profile not found

  /result/{child_id}/learning_unit_overall/{participation_type}/:
    get:
      summary: Get overall results for a child's learning unit assignments based on participation type
      description: Retrieve overall results for a child's learning unit assignments based on participation type
      tags:
        - Child Results
      parameters:
        - name: child_id
          in: path
          required: true
          schema:
            type: string
        - name: participation_type
          in: path
          required: true
          schema:
            type: string
            enum: [required, recommended]
      responses:
        '200':
          description: Overall results data
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_exercises:
                    type: integer
                  completed_exercises:
                    type: integer
                  total_time_spent:
                    type: integer
        '404':
          description: Child profile not found

  /result/{child_id}/exercise/{exercise_id}/:
    get:
      summary: Get child's results for a specific exercise
      description: Retrieve results for a specific exercise for a child
      tags:
        - Child Results
      parameters:
        - name: child_id
          in: path
          required: true
          schema:
            type: string
        - name: exercise_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Exercise results data
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Exercise_Result'
        '404':
          description: Child profile or exercise not found
    post:
      summary: Mark a child's exercise result as completed
      description: Mark a specific exercise result as completed for a child
      tags:
        - Child Results
      parameters:
        - name: child_id
          in: path
          required: true
          schema:
            type: string
        - name: exercise_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '201':
          description: Exercise marked as completed
        '404':
          description: Child profile, exercise, or assignment not found

  /result/{child_id}/question/{question_id}/:
    get:
      summary: Get child's results for a specific question
      description: Retrieve results for a specific question for a child
      tags:
        - Child Results
      parameters:
        - name: child_id
          in: path
          required: true
          schema:
            type: string
        - name: question_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Question results data
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Question_Result'
        '404':
          description: Child profile or question not found
    post:
      summary: Create or update child's question result
      description: Create or update a result for a specific question for a child
      tags:
        - Child Results
      parameters:
        - name: child_id
          in: path
          required: true
          schema:
            type: string
        - name: question_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                num_correct:
                  type: integer
                num_incorrect:
                  type: integer
                time_spent:
                  type: integer
              required:
                - num_correct
                - num_incorrect
                - time_spent
      responses:
        '201':
          description: Result created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Question_Result'
        '400':
          description: Missing required fields
        '404':
          description: Child profile, question, or assignment not found

  /AI/assess_speech/:
    post:
      summary: Assess speech using Azure AI
      description: Analyze and assess speech audio using Azure AI services
      tags:
        - Azure AI
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                audio_file:
                  type: string
                  format: binary
      responses:
        '200':
          description: Speech assessment result
          content:
            application/json:
              schema:
                type: object
                properties:
                  score:
                    type: number
                    format: float
                  feedback:
                    type: string
        '400':
          description: Invalid input data

  /AI/text_to_speech/:
    post:
      summary: Convert text to speech using Azure AI
      description: Generate speech audio from text using Azure AI services
      tags:
        - Azure AI
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                text:
                  type: string
              required:
                - text
      responses:
        '200':
          description: Generated speech audio
          content:
            audio/wav:
              schema:
                type: string
                format: binary
        '400':
          description: Invalid input data
  /profile/{profile_id}/coins/:
    get:
      summary: Add coins to a profile
      description: Add the coin total for a profile ID
      tags:
        - Profiles
      parameters:
        - name: profile_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Coins returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  coins:
                    type: integer
        '404':
          description: Profile not found
    put:
      summary: Get coins for a profile
      description: Retrieve the coin total for a profile ID
      tags:
        - Profiles
      parameters:
        - name: profile_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                coins:
                  type: integer
              required:
                - item_id
      responses:
        '200':
          description: Coins returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  coins:
                    type: integer
        '400':
          description: Invalid coin amount, or non existent coins
        '401':
          description: Coins added must be positive 
        '404':
          description: Profile not found
  /profile/{profile_id}/streak/:
    get:
      summary: Get the streak for a profile
      description:  Retrieve the coin total for a profile ID
      tags:
        - Profiles
      parameters:
        - name: profile_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Streak returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  streak:
                    type: integer
        '404':
          description: Profile not found
  /profile/shop/:
    get:
      summary: Get everything from the shop
      description:  Retrieve all purchasable items
      tags:
        - Profiles
      responses:
        '200':
          description: Shop returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Shop_Item'
  /profile/shop/{item_id}:
    get:
      summary: Get an item from the shop
      description:  Retrieve a purchasable items
      tags:
        - Profiles
      parameters:
        - name: item_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Item returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  item:
                    $ref: '#/components/schemas/Shop_Item'
  /profile/{profile_id}/inv/:
    get:
      summary: Get the inventory for the profile
      description:  Retrieve all the items that a user has purchased
      tags:
        - Profiles
      parameters:
        - name: profile_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: inventory returned
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Shop_Item'
        '404':
          description: Profile not found
  /profile/{profile_id}/inv/{item_id}/:
    post:
      summary: Add an item to a players inventory
      description: Purchase an item for a profile
      tags:
        - Profiles
      parameters:
        - name: profile_id
          in: path
          required: true
          schema:
            type: string
        - name: item_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Success
        '404':
          description: Profile not found    
  /profile/{profile_id}/mascot/:
    get:
      summary: Get the equipped mascot items for a profile
      description:  Retrieve the currently equipped mascot items
      tags:
        - Profiles
      parameters:
        - name: profile_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Equipped items returned
          content:
            application/json:
              schema:
                type: object
                properties:
                  head:
                    $ref: '#/components/schemas/Shop_Item'
                    nullable: true
                  toros:
                    $ref: '#/components/schemas/Shop_Item'
                    nullable: true
        '400':
          description: More then 2 items are equipped (DB error)
        '404':
          description: Profile not found
    put:
      summary: Equipped mascot items for a profile
      description:  Equip a new item, then return the newly equipped items.
      tags:
        - Profiles
      parameters:
        - name: profile_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                item_id:
                  type: string
                  format: uuid
              required:
                - item_id
      responses:
        '200':
          description: Item Equipped
          content:
            application/json:
              schema:
                type: object
                properties:
                  head:
                    $ref: '#/components/schemas/Shop_Item'
                    nullable: true
                  toros:
                    $ref: '#/components/schemas/Shop_Item'
                    nullable: true
        '400':
          description: More then 2 items are equipped (DB error)
        '401':
          description: Item has not been purchased 
        '404':
          description: Profile not found

components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        user_type:
          type: string
          enum: [parent, therapist]
        subscription_type:
          type: string
          nullable: true
          description: Type of subscription. Can be null for users without an active subscription.
        subscription_start:
          type: string
          format: date-time
          nullable: true
          description: Start date of the subscription. Can be null for users without an active subscription.
        subscription_end:
          type: string
          format: date-time
          nullable: true
          description: End date of the subscription. Can be null for users without an active subscription.
        created_at:
          type: string
          format: date-time

    Profile:
      type: object
      properties:
        id:
          type: string
          format: uuid
        profile_type:
          type: string
          enum: [parent, therapist, child]
        name:
          type: string
        profile_picture:
          type: string
          format: uri
        pin_hash:
          type: string
        child_details:
          type: object
        created_at:
          type: string
          format: date-time

    User_Profile:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user:
          $ref: '#/components/schemas/User'
        profile:
          $ref: '#/components/schemas/Profile'
        created_at:
          type: string
          format: date-time

    Learning_Unit:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
        category:
          type: string
        image:
          type: string
        created_at:
          type: string
          format: date-time

    Exercise:
      type: object
      properties:
        id:
          type: string
        learning_unit:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        order:
          type: integer
        exercise_type:
          type: string
          enum: [multiple_drag, multiple_select, ordered_drag, speaking]
        created_at:
          type: string
          format: date-time

    Question:
      type: object
      properties:
        id:
          type: string
        exercise:
          type: string
          format: uuid
        question_type:
          type: string
          enum: [multiple_drag, multiple_select, ordered_drag, speaking]
        order:
          type: integer
        question_data:
          type: string
          format: JSON
          description: This will be JSON data
        created_at:
          type: string
          format: date-time

    Assignment:
      type: object
      properties:
        id:
          type: string
        learning_unit:
          $ref: '#/components/schemas/Learning_Unit'
        participation_type:
          type: string
          enum: [required, recommended]
        num_question_attempts:
          type: integer
        assigned_to:
          $ref: '#/components/schemas/Profile'
        assigned_by:
          $ref: '#/components/schemas/User'
        assigned_at:
          type: string
          format: date-time
        due_date:
          type: string
          format: date-time
          nullable: true
        completed_at:
          type: string
          format: date-time
          nullable: true

    Exercise_Result:
      type: object
      properties:
        id:
          type: string
        assignment:
          type: string
          format: uuid
        exercise:
          $ref: '#/components/schemas/Exercise'
        time_spent:
          type: integer
        num_correct:
          type: integer
        num_incorrect:
          type: integer
        accuracy:
          type: number
          format: float
        completed_at:
          type: string
          format: date-time

    Question_Result:
      type: object
      properties:
        id:
          type: string
        exercise_result:
          $ref: '#/components/schemas/Exercise_Result'
        question:
          $ref: '#/components/schemas/Question'
        time_spent:
          type: integer
        num_correct:
          type: integer
        num_incorrect:
          type: integer
        completed_at:
          type: string
          format: date-time

    Child_Embedding:
      type: object
      properties:
        id:
          type: string
        child_profile:
          type: string
          format: uuid
        question:
          type: string
          format: uuid
        child_input_text:
          type: string
        embedding:
          type: string
          format: JSON
        created_at:
          type: string
          format: date-time

    Question_Embedding:
      type: object
      properties:
        id:
          type: string
        question:
          type: string
          format: uuid
        expected_answer_text:
          type: string
        embedding:
          type: string
          format: JSON
        created_at:
          type: string
          format: date-time

    Rag_Context:
      type: object
      properties:
        id:
          type: string
        source_name:
          type: string
        source_url:
          type: string
        content_chunk:
          type: string
        embedding:
          type: string
          format: JSON
        created_at:
          type: string
          format: date-time
    Shop_Item:
      type: object
      properties:
        id: 
          type: string
          format: uuid
        item_type:
          type: string
          enum: [head, torso]
        icon_image:
          type: string
          format: url
        mascot_image:
          type: string
          format: json
        price: 
          type: integer
